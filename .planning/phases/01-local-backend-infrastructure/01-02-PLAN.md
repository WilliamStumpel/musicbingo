---
phase: 01-local-backend-infrastructure
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - musicbingo_api/src/musicbingo_api/main.py
  - musicbingo_api/src/musicbingo_api/game_service.py
  - musicbingo_api/src/musicbingo_api/game_loader.py
  - games/
autonomous: true
---

<objective>
Add game persistence and selection so DJ can pre-load 8 games and switch between them during a gig.

Purpose: DJ prepares games before the gig, loads them at venue, and switches between games without re-importing.
Output: Games directory with JSON files, load/list endpoints, ability to switch active game.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@musicbingo_api/src/musicbingo_api/main.py
@musicbingo_api/src/musicbingo_api/game_service.py
@musicbingo_api/src/musicbingo_api/schemas.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create game loader module</name>
  <files>musicbingo_api/src/musicbingo_api/game_loader.py</files>
  <action>
Create module to load/save games from JSON files:

```python
import json
from pathlib import Path
from uuid import UUID
from typing import Optional
from .models import GameState, Song, CardData, PatternType, GameStatus

GAMES_DIR = Path(__file__).parent.parent.parent.parent / "games"

def list_available_games() -> list[dict]:
    """List all game JSON files in games/ directory.

    Returns list of {filename, game_id, name, song_count, card_count}
    """

def load_game_from_file(filename: str) -> GameState:
    """Load a game from JSON file and return GameState ready to play.

    JSON format matches card generator export:
    {
        "game_id": "uuid",
        "name": "Game Name",
        "playlist": [...],
        "cards": [...]
    }
    """

def save_game_to_file(game: GameState, filename: str) -> None:
    """Save current game state to JSON file for later reload."""
```

Create games/ directory at project root if not exists.
Handle missing directory gracefully (return empty list).
  </action>
  <verify>Create sample game JSON, call list_available_games() returns it</verify>
  <done>Can list and load games from games/ directory</done>
</task>

<task type="auto">
  <name>Task 2: Add game list and load endpoints</name>
  <files>musicbingo_api/src/musicbingo_api/main.py, musicbingo_api/src/musicbingo_api/schemas.py</files>
  <action>
Add two new endpoints:

1. `GET /api/games` - List available games from games/ directory
   Response: `{"games": [{"filename": "...", "game_id": "...", "name": "...", "song_count": N, "card_count": N}]}`

2. `POST /api/games/load/{filename}` - Load a game file into memory, ready to play
   - Loads game from JSON file
   - Registers in GameService (replaces if game_id exists)
   - Sets status to SETUP (needs activation)
   Response: `{"game_id": "...", "name": "...", "status": "setup", "card_count": N}`

Add corresponding Pydantic schemas:
- `GameListResponse`
- `GameListItem`
- `LoadGameResponse`

Import and use game_loader functions in main.py.
  </action>
  <verify>curl /api/games lists files, curl -X POST /api/games/load/sample.json loads game</verify>
  <done>API can list and load pre-made game files</done>
</task>

<task type="auto">
  <name>Task 3: Create sample game file for testing</name>
  <files>games/sample-game.json</files>
  <action>
Create a sample game JSON file with:
- Valid game_id UUID
- Name: "Sample Music Bingo"
- Playlist: 25 songs with title, artist, song_id (can be placeholder data)
- Cards: 5 sample cards with valid song_positions grids

This serves as:
1. Template for DJ to understand format
2. Test data for development
3. Documentation of expected JSON structure

Include comment at top (JSON doesn't support comments, so add a "_comment" field):
```json
{
  "_comment": "Sample game file - replace with real playlist export from card generator",
  "game_id": "...",
  ...
}
```
  </action>
  <verify>python -m json.tool games/sample-game.json validates, /api/games/load/sample-game.json works</verify>
  <done>Sample game file exists and can be loaded via API</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `GET /api/games` returns list of JSON files in games/
- [ ] `POST /api/games/load/sample-game.json` loads the sample game
- [ ] Loaded game appears in `GET /api/game/{game_id}/state`
- [ ] Game can be activated and used for verification
</verification>

<success_criteria>

- All tasks completed
- DJ can place game JSON files in games/ directory
- API lists available games
- API loads games into memory for play
- Sample game provides template and test data
</success_criteria>

<output>
After completion, create `.planning/phases/01-local-backend-infrastructure/01-02-SUMMARY.md`
</output>
