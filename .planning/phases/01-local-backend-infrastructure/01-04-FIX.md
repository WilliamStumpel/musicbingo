---
phase: 01-local-backend-infrastructure
plan: 01-04-FIX
type: fix
wave: 1
depends_on: ["01-04"]
files_modified:
  - musicbingo_host/src/components/ConnectionInfo.jsx
  - musicbingo_host/src/services/gameApi.js
autonomous: true
---

<objective>
Fix 1 UAT issue from plan 01-04.

Source: 01-04-ISSUES.md
Priority: 0 critical, 1 major, 0 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/01-local-backend-infrastructure/01-04-ISSUES.md

**Original plan for reference:**
@.planning/phases/01-local-backend-infrastructure/01-04-PLAN.md

**Current implementation:**
@musicbingo_host/src/components/ConnectionInfo.jsx
@musicbingo_host/src/services/gameApi.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add getServerInfo API function</name>
  <files>musicbingo_host/src/services/gameApi.js</files>
  <action>
Add a function to fetch the server's network info from the existing `/api/server-info` endpoint:

```javascript
/**
 * Get server network info (IP, port, URL).
 * Used for QR code display to show the actual network URL.
 */
export async function getServerInfo() {
  const response = await fetch(`${API_BASE}/api/server-info`);
  if (!response.ok) throw new Error('Failed to get server info');
  return response.json();
}
```

This endpoint already exists in the backend and returns:
- ip: The local network IP (e.g., "192.168.1.100")
- port: The server port (8000)
- url: The full URL (e.g., "http://192.168.1.100:8000")
  </action>
  <verify>Function exists in gameApi.js</verify>
  <done>getServerInfo function added to gameApi.js</done>
</task>

<task type="auto">
  <name>Task 2: Update ConnectionInfo to fetch real server URL</name>
  <files>musicbingo_host/src/components/ConnectionInfo.jsx</files>
  <action>
Modify ConnectionInfo to:
1. Import getServerInfo from gameApi
2. Add useState for serverUrl (default to API_BASE as fallback)
3. Add useEffect to fetch server info when modal opens
4. Display the fetched URL instead of hardcoded API_BASE

Changes:
- Add: `import { getServerInfo } from '../services/gameApi';`
- Keep API_BASE import as fallback
- Add state: `const [serverUrl, setServerUrl] = useState(API_BASE);`
- Add useEffect that calls getServerInfo() when isOpen becomes true
- On success: setServerUrl(data.url)
- On error: keep using API_BASE fallback (localhost)
- Use serverUrl in QRCodeSVG value and code display

This ensures the QR code shows the actual network IP (192.168.x.x:8000) that phones can connect to, not localhost.
  </action>
  <verify>Open modal shows network IP URL, not localhost</verify>
  <done>ConnectionInfo displays actual network URL from server-info endpoint</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Build succeeds: `cd musicbingo_host && npm run build`
- [ ] QR code modal shows network IP URL (not localhost)
- [ ] Fallback to localhost works if server-info fails
</verification>

<success_criteria>
- UAT-001 fixed: QR code shows actual network IP URL
- Phones on same network can use the displayed URL to connect
- Tests pass
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/01-local-backend-infrastructure/01-04-FIX-SUMMARY.md`
</output>
