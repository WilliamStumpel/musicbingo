---
phase: 01-local-backend-infrastructure
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - musicbingo_verify/src/config.js
  - musicbingo_verify/src/components/ServerConnect.jsx
  - musicbingo_verify/src/components/ServerConnect.css
  - musicbingo_verify/src/App.js
autonomous: false
---

<objective>
Update scanner PWA to connect to local backend server instead of hardcoded production URL.

Purpose: Phone scanner needs to find and connect to DJ's laptop on local WiFi network.
Output: Scanner app with server connection UI that works on local network.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@musicbingo_verify/src/config.js
@musicbingo_verify/src/App.js
@musicbingo_verify/src/services/apiClient.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add server URL configuration state</name>
  <files>musicbingo_verify/src/config.js, musicbingo_verify/src/App.js</files>
  <action>
Update config.js to support dynamic server URL:
- Export a function `getApiUrl()` that reads from localStorage or returns default
- Export a function `setApiUrl(url)` that saves to localStorage
- Default to localhost:8000 for development

Update App.js:
- Add state for `serverUrl` and `isConnected`
- On mount, check if saved server URL exists and test connection via healthCheck()
- If not connected, show ServerConnect component instead of Scanner
- Pass `onConnect` callback to ServerConnect that updates state and saves URL

Flow: App checks connection → not connected → show ServerConnect → user enters IP → connected → show Scanner
  </action>
  <verify>App shows connection screen on first load when no server configured</verify>
  <done>App manages server connection state and persists URL in localStorage</done>
</task>

<task type="auto">
  <name>Task 2: Create ServerConnect component</name>
  <files>musicbingo_verify/src/components/ServerConnect.jsx, musicbingo_verify/src/components/ServerConnect.css</files>
  <action>
Create component for entering server URL:

UI elements:
- Header: "Connect to Music Bingo Server"
- Text input for server URL (placeholder: "192.168.1.x:8000")
- "Connect" button
- Status message (connecting... / connected / error)
- Instructions: "Enter the IP address shown on the DJ's laptop"

Behavior:
- On submit, construct URL as `http://${input}` if no protocol
- Call apiClient.healthCheck() to verify connection
- On success, call onConnect(url) prop
- On failure, show error message "Could not connect. Check the IP and make sure server is running."

Styling:
- Center on screen
- Large input for easy mobile entry
- Clear error states (red border on failure)
- Match existing app styling (green theme from ResultDisplay)
  </action>
  <verify>Component renders, accepts IP input, tests connection</verify>
  <done>User can enter server IP and establish connection</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Scanner PWA with server connection flow - shows connection screen, accepts IP, connects to local server</what-built>
  <how-to-verify>
    1. Start backend: ./scripts/start-server.sh (note the IP displayed)
    2. Start frontend: cd musicbingo_verify && npm start
    3. Open http://localhost:3000 in browser
    4. Verify: Connection screen appears (not scanner)
    5. Enter the server IP shown by start-server.sh (e.g., 192.168.1.100:8000)
    6. Click Connect
    7. Verify: Scanner view appears after successful connection
    8. Refresh page - should still be connected (URL saved)
    9. Test on phone: Open http://LAPTOP_IP:3000 on phone browser
    10. Enter same server IP, verify connection works from phone
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] App shows ServerConnect on first load
- [ ] Can enter server IP and connect
- [ ] Connection persists after page refresh (localStorage)
- [ ] Scanner appears after successful connection
- [ ] Works from phone browser on same WiFi network
</verification>

<success_criteria>

- All tasks completed
- Scanner PWA connects to local server via user-provided IP
- Connection state persists across page refreshes
- Phone on same WiFi can connect to scanner app and verify cards
</success_criteria>

<output>
After completion, create `.planning/phases/01-local-backend-infrastructure/01-03-SUMMARY.md`
</output>
