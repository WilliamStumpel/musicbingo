---
phase: 01-local-backend-infrastructure
plan: 01-03-FIX2
type: fix
wave: 1
depends_on: []
files_modified:
  - musicbingo_verify/src/components/Scanner.jsx
  - musicbingo_verify/src/components/Scanner.css
autonomous: true
---

<objective>
Fix 1 UAT issue from plan 01-03.

Source: 01-03-ISSUES.md
Priority: 1 blocker

UAT-002: Scanner QR detection not triggering verification - QR code is outlined but callback doesn't fire. Add manual code entry as fallback.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/01-local-backend-infrastructure/01-03-ISSUES.md

**Original plan for reference:**
@.planning/phases/01-local-backend-infrastructure/01-03-PLAN.md

**Scanner component:**
@musicbingo_verify/src/components/Scanner.jsx
@musicbingo_verify/src/hooks/useScanner.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add debug logging to Scanner callback</name>
  <files>musicbingo_verify/src/components/Scanner.jsx</files>
  <action>
Add console.log statements to understand why QR detection isn't triggering:

1. Add log in QrScanner callback (line ~26) BEFORE handleScan is called:
   `console.log('QrScanner detected:', result);`

2. Add log at the top of the local handleScan function (line ~69):
   `console.log('handleScan called, isScanning:', isScanning, 'data:', data);`

3. The qr-scanner library v1.4.2 with highlightCodeOutline shows outlines via canvas overlay separately from the scan callback. The outline appearing but callback not firing suggests:
   - Either the library isn't successfully decoding the QR (just detecting its location)
   - Or there's a version/compatibility issue

4. Check if isScanning is getting stuck as false - add log after scanner.start() succeeds:
   `console.log('Scanner started, isScanning will be:', true);`

5. Initialize isScanning to true instead of false to ensure we don't block initial scans:
   Change line 13 from `useState(false)` to `useState(true)`
  </action>
  <verify>Console shows debug output when pointing at QR code</verify>
  <done>Debug logging added, isScanning initialization fixed</done>
</task>

<task type="auto">
  <name>Task 2: Add manual code entry fallback</name>
  <files>musicbingo_verify/src/components/Scanner.jsx, musicbingo_verify/src/components/Scanner.css</files>
  <action>
Add a text input below the scanner for manual code entry as fallback:

1. Add state for manual input: `const [manualCode, setManualCode] = useState('');`

2. Add UI below the scan-frame div (inside scanner-container but after scan-overlay):
   ```jsx
   <div className="manual-entry">
     <p className="manual-label">Or enter code manually:</p>
     <div className="manual-input-group">
       <input
         type="text"
         value={manualCode}
         onChange={(e) => setManualCode(e.target.value)}
         placeholder="card_id|game_id|checksum"
         className="manual-input"
       />
       <button
         onClick={() => {
           if (manualCode.trim()) {
             onScan(manualCode.trim());
             setManualCode('');
           }
         }}
         disabled={!manualCode.trim()}
         className="manual-submit"
       >
         Verify
       </button>
     </div>
   </div>
   ```

3. Add CSS for manual entry section:
   - Position below scanner video
   - Match app theme (dark background, green accents)
   - Mobile-friendly input size
   - Clear button styling
  </action>
  <verify>Manual entry input visible below scanner, can type code and click Verify</verify>
  <done>Manual code entry fallback working</done>
</task>

<task type="auto">
  <name>Task 3: Test and verify fix</name>
  <files>musicbingo_verify/src/components/Scanner.jsx</files>
  <action>
Test the scanner fixes:

1. Start the scanner app: `cd musicbingo_verify && npm start`

2. Check browser console for debug logs when pointing camera at QR code:
   - "QrScanner detected:" should appear when QR is outlined
   - "handleScan called" should appear when callback fires
   - If detected but handleScan not called, there's a library issue
   - If handleScan called but isScanning false, initialization was the bug

3. Test manual entry:
   - Enter a valid QR code format: `card_id|game_id|checksum`
   - Click Verify - should trigger verification flow

4. Based on console output, make additional fixes if needed:
   - If qr-scanner library detects but doesn't decode, may need to check returnDetailedScanResult setting
   - If library doesn't call callback at all, consider upgrading or trying alternative
  </action>
  <verify>Either QR scanning works or manual entry provides functional fallback</verify>
  <done>Scanner verification working via QR or manual entry</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Debug logging reveals scan flow behavior
- [ ] Manual code entry UI visible and functional
- [ ] At least one method (QR scan or manual entry) successfully triggers verification
- [ ] User can verify bingo cards
</verification>

<success_criteria>
- UAT-002 from 01-03-ISSUES.md resolved
- Scanner has working verification path (QR scan or manual entry fallback)
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/01-local-backend-infrastructure/01-03-FIX2-SUMMARY.md`
</output>
