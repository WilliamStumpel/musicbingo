---
phase: 07-prize-winner-tracking
plan: 03
type: execute
wave: 3
depends_on: ["07-02"]
files_modified:
  - musicbingo_host/src/components/CardStatusPanel.jsx
  - musicbingo_host/src/components/CardStatusPanel.css
  - musicbingo_host/src/components/PrizeInput.jsx
  - musicbingo_host/src/components/PrizeInput.css
  - musicbingo_host/src/components/WinnerLog.jsx
  - musicbingo_host/src/components/WinnerLog.css
  - musicbingo_host/src/pages/HostView.jsx
  - musicbingo_host/src/pages/HostView.css
  - musicbingo_host/src/pages/PlayerView.jsx
  - musicbingo_host/src/pages/PlayerView.css
  - musicbingo_host/src/components/PrizeDisplay.jsx
  - musicbingo_host/src/components/PrizeDisplay.css
  - musicbingo_host/src/components/WinnerAnnouncement.jsx
  - musicbingo_host/src/components/WinnerAnnouncement.css
autonomous: true
---

<objective>
Build host UI panel for card statuses and winner log, plus venue display features for prize and winner announcements.

Purpose: Give DJ visibility into all registered cards and winners (cheat sheet), display prize on venue TV, celebrate winners publicly after verification.
Output: CardStatusPanel slide-out, PrizeInput, WinnerLog, PrizeDisplay on PlayerView, WinnerAnnouncement overlay.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-prize-winner-tracking/07-01-SUMMARY.md
@.planning/phases/07-prize-winner-tracking/07-02-SUMMARY.md

@musicbingo_host/src/pages/HostView.jsx
@musicbingo_host/src/pages/PlayerView.jsx
@musicbingo_host/src/hooks/useGameState.js
@musicbingo_host/src/services/gameApi.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PrizeInput component</name>
  <files>musicbingo_host/src/components/PrizeInput.jsx, musicbingo_host/src/components/PrizeInput.css</files>
  <action>
Create PrizeInput component for setting the game prize:

PrizeInput.jsx:
- Props: currentPrize, onSetPrize, disabled
- Shows current prize if set, or placeholder "Set prize..."
- Click to edit: text input appears
- Enter to save, Escape to cancel
- Compact inline design that fits in header controls area
- Shows "Prize: $50 Cash" format when set

PrizeInput.css:
- Inline display, fits with other header controls
- Input field appears on click, replaces display text
- Subtle border, matches other controls styling
- Gold/yellow accent for prize text to stand out
  </action>
  <verify>Component renders and allows prize entry</verify>
  <done>PrizeInput component allows setting prize text</done>
</task>

<task type="auto">
  <name>Task 2: Create CardStatusPanel slide-out</name>
  <files>musicbingo_host/src/components/CardStatusPanel.jsx, musicbingo_host/src/components/CardStatusPanel.css</files>
  <action>
Create CardStatusPanel as a slide-out panel (DJ's cheat sheet):

CardStatusPanel.jsx:
- Props: isOpen, onClose, gameId
- Fetches card statuses from API (getCardStatuses) on open and polls every 5 seconds while open
- Shows list of all registered cards with:
  - Card number and player name
  - Progress bar or fraction (e.g., "4/5")
  - WINNER badge if is_winner
- Sort: Winners at top, then by progress (closest to winning first)
- Header shows total registered, total winners
- Close button (X) in corner

CardStatusPanel.css:
- Slide-out from right side of screen
- Fixed position, full height, 350px width
- Dark semi-transparent backdrop when open
- White/light background for panel
- Smooth slide animation (transform translateX)
- Card items in scrollable list
- Winner items highlighted with gold border/background
- Progress shown as colored bar (green when close to winning)
  </action>
  <verify>Panel slides out, shows card statuses, highlights winners</verify>
  <done>CardStatusPanel shows all registered cards with progress and winner status</done>
</task>

<task type="auto">
  <name>Task 3: Create WinnerLog component</name>
  <files>musicbingo_host/src/components/WinnerLog.jsx, musicbingo_host/src/components/WinnerLog.css</files>
  <action>
Create WinnerLog component showing verified winners with prize assignment:

WinnerLog.jsx:
- Props: winners (array of confirmed winners), onAssignPrize
- Shows list of winners in order verified:
  - Card number, player name
  - Pattern they won with
  - Time verified
  - Prize dropdown or "Assign Prize" button
- Prize options: Use current game prize or custom entry
- Compact design, can be shown in CardStatusPanel or separate section

WinnerLog.css:
- List style with clear separation between entries
- Winner info on left, prize assignment on right
- Dropdown or select for prize assignment
- Completed prizes shown with checkmark
- Celebration styling (subtle gold accents)
  </action>
  <verify>Component renders winner list with prize assignment</verify>
  <done>WinnerLog shows verified winners and allows prize assignment</done>
</task>

<task type="auto">
  <name>Task 4: Integrate CardStatusPanel and PrizeInput into HostView</name>
  <files>musicbingo_host/src/pages/HostView.jsx, musicbingo_host/src/pages/HostView.css</files>
  <action>
Add CardStatusPanel and PrizeInput to HostView:

1. Import CardStatusPanel, PrizeInput, WinnerLog components
2. Add state: `isCardPanelOpen: false`
3. Add button in header to toggle CardStatusPanel (icon: list or cards)
4. Add PrizeInput in header controls (after PatternSelector)
5. Destructure setPrize, currentPrize from useGameState
6. Render CardStatusPanel with isOpen state
7. Include WinnerLog inside CardStatusPanel (below card list)

Layout:
- PrizeInput appears inline in header
- "Cards" button opens slide-out panel
- Panel shows card statuses at top, winner log at bottom
  </action>
  <verify>Host can set prize, open card panel, see winner log</verify>
  <done>HostView has prize input and card status panel with winner log</done>
</task>

<task type="auto">
  <name>Task 5: Create PrizeDisplay component for PlayerView</name>
  <files>musicbingo_host/src/components/PrizeDisplay.jsx, musicbingo_host/src/components/PrizeDisplay.css</files>
  <action>
Create PrizeDisplay component for venue TV advertisement:

PrizeDisplay.jsx:
- Props: prize (string), isVisible (boolean for show/hide animation)
- Shows prize in eye-catching advertisement style
- Format: "WIN: $50 Cash!" or "PRIZE: Free Drinks!"
- Animated entrance (fade in, slight scale)
- Designed for large TV visibility

PrizeDisplay.css:
- Large, bold text (48px+)
- Gold/yellow gradient background or border
- White text with subtle shadow for readability
- Centered in container
- Sparkle or glow effect (CSS animation)
- Fade in/out animation for visibility toggle
  </action>
  <verify>Component displays prize with celebration styling</verify>
  <done>PrizeDisplay shows prize in advertisement style</done>
</task>

<task type="auto">
  <name>Task 6: Create WinnerAnnouncement component for PlayerView</name>
  <files>musicbingo_host/src/components/WinnerAnnouncement.jsx, musicbingo_host/src/components/WinnerAnnouncement.css</files>
  <action>
Create WinnerAnnouncement overlay for venue TV:

WinnerAnnouncement.jsx:
- Props: winner ({card_number, player_name, pattern, prize}), onDismiss
- Full-screen overlay when winner verified
- Shows: "BINGO!", card number, player name, pattern, prize won
- Celebration animation (confetti effect via CSS or simple)
- Auto-dismiss after 8 seconds OR host can dismiss from their view
- Listens to localStorage for winner announcement trigger

WinnerAnnouncement.css:
- Full viewport overlay
- Dark semi-transparent background
- Center content with large celebratory text
- Gold/white color scheme
- "BINGO!" in huge font (100px+)
- Player name and card prominent
- Pulsing/glowing animation
- Confetti: CSS pseudo-elements with animation (optional, keep simple)
  </action>
  <verify>Announcement overlay shows with celebration styling</verify>
  <done>WinnerAnnouncement displays full-screen celebration on PlayerView</done>
</task>

<task type="auto">
  <name>Task 7: Integrate PrizeDisplay and WinnerAnnouncement into PlayerView</name>
  <files>musicbingo_host/src/pages/PlayerView.jsx, musicbingo_host/src/pages/PlayerView.css</files>
  <action>
Add prize display and winner announcement to PlayerView:

1. Import PrizeDisplay and WinnerAnnouncement
2. Read currentPrize from localStorage (synced from host)
3. Add state for winner announcement: listen to localStorage key `musicbingo_winner_announcement`
4. Prize display logic:
   - Show PrizeDisplay when song title is hidden (before reveal)
   - Alternate: show for 3-5 seconds, then hide, cycle if title still hidden
   - Hide when song title is revealed
5. Winner announcement logic:
   - When localStorage `musicbingo_winner_announcement` changes, show WinnerAnnouncement
   - Parse winner data from localStorage JSON
   - Auto-dismiss after timeout, then clear localStorage key
6. Layout:
   - PrizeDisplay in the "now playing" area when title hidden
   - WinnerAnnouncement as full-screen overlay above everything
  </action>
  <verify>PlayerView shows prize when title hidden, shows winner announcement when triggered</verify>
  <done>PlayerView displays prize during hidden title and winner celebrations</done>
</task>

<task type="auto">
  <name>Task 8: Add winner announcement trigger to verification flow</name>
  <files>musicbingo_verify/src/App.js</files>
  <action>
Trigger winner announcement on PlayerView after successful verification:

1. In the Scanner app, after a card is verified as WINNER:
   - Create winner announcement data: {card_number, player_name, pattern, prize, timestamp}
   - Get player_name from registered cards (may need API call or store in verification response)
   - Get prize from game state
2. Write to localStorage key `musicbingo_winner_announcement` with JSON data
3. PlayerView will pick this up and display the announcement

Note: The verification response should include player_name if card is registered. May need to update verify endpoint to include this info.

Also update the backend verify endpoint (main.py) to include player_name in VerifyCardResponse if the card is registered.
  </action>
  <verify>Scanning a winning card triggers announcement on PlayerView</verify>
  <done>Winner verification triggers celebration on venue display</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Host: PrizeInput allows setting prize
- [ ] Host: CardStatusPanel slides out showing all registered cards with progress
- [ ] Host: WinnerLog shows verified winners with prize assignment
- [ ] PlayerView: Prize displays when song title is hidden
- [ ] PlayerView: Winner announcement shows full-screen celebration after verification
- [ ] Announcement includes card number, player name, pattern, prize
- [ ] All components styled for their context (host=functional, player=spectacular)
</verification>

<success_criteria>
- All tasks completed
- DJ can see all registered cards and their status (cheat sheet)
- DJ can set prize and it displays on venue TV
- Winner announcement appears on venue TV after verification
- Celebration is visually impactful for venue audience
</success_criteria>

<output>
After completion, create `.planning/phases/07-prize-winner-tracking/07-03-SUMMARY.md`
</output>
