---
phase: 04-host-view
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - musicbingo_host/src/hooks/useGameState.js
  - musicbingo_host/src/components/CallBoard.jsx
  - musicbingo_host/src/components/CallBoard.css
  - musicbingo_host/src/components/PatternSelector.jsx
  - musicbingo_host/src/components/PatternSelector.css
  - musicbingo_host/src/App.js
  - musicbingo_host/src/App.css
autonomous: true
---

<objective>
Transform host app from simple checklist to full host view with Now Playing tracking, Call Board, and Pattern Selection.

Purpose: Give DJ a complete game management interface showing current song, play history, and pattern control.
Output: Host app with three-panel layout: Call Board (left), Song Checklist (center), Controls (right).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-spotify-integration/03-02-SUMMARY.md

# Existing source files
@musicbingo_host/src/hooks/useGameState.js
@musicbingo_host/src/components/SongChecklist.jsx
@musicbingo_host/src/services/gameApi.js
@musicbingo_host/src/App.js

# API reference for pattern endpoint
@musicbingo_api/src/musicbingo_api/main.py
@musicbingo_api/src/musicbingo_api/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend useGameState hook with nowPlaying and pattern state</name>
  <files>musicbingo_host/src/hooks/useGameState.js, musicbingo_host/src/services/gameApi.js</files>
  <action>
Add to useGameState.js:
- `nowPlaying` state (song_id of currently playing song, null if none)
- `currentPattern` state (PatternType string from game state)
- `setNowPlaying(songId)` action - sets nowPlaying, auto-marks song as played if not already
- `setPattern(pattern)` action - calls PATCH /api/game/{id}/pattern?pattern={pattern}, updates local state

Add to gameApi.js:
- `setPattern(gameId, pattern)` function - POST to /api/game/{game_id}/pattern?pattern={pattern}

Load currentPattern from game state response in loadGame function.

Pattern types from backend: five_in_a_row, row, column, diagonal, four_corners, x_pattern, full_card
  </action>
  <verify>npm start in musicbingo_host/ compiles without errors. Console.log pattern state after loading game shows correct value.</verify>
  <done>Hook exports nowPlaying, currentPattern, setNowPlaying, setPattern. Pattern loads from game state.</done>
</task>

<task type="auto">
  <name>Task 2: Create CallBoard component</name>
  <files>musicbingo_host/src/components/CallBoard.jsx, musicbingo_host/src/components/CallBoard.css</files>
  <action>
Create CallBoard component showing played songs in play order:

Props:
- songs: array of all songs (for looking up title/artist by song_id)
- playedSongs: Set of played song_ids (from useGameState)
- playedOrder: array of song_ids in order played (need to track this)
- nowPlaying: current song_id being played

Display:
- Header: "Call Board" with count (e.g., "12 played")
- Scrollable list of played songs, most recent at top
- Each row shows: title, artist
- Current "now playing" song highlighted with different background (e.g., amber/yellow)
- Played songs in muted color
- Empty state: "No songs played yet"

Style:
- Dark theme consistent with existing app
- Compact rows (song fits on single line with ellipsis)
- Fixed height container with overflow scroll
- Min-width: 250px for desktop layout
  </action>
  <verify>Component renders in isolation. Songs display in order with now playing highlighted.</verify>
  <done>CallBoard.jsx and CallBoard.css exist. Component shows played songs with now playing highlight.</done>
</task>

<task type="auto">
  <name>Task 3: Create PatternSelector component</name>
  <files>musicbingo_host/src/components/PatternSelector.jsx, musicbingo_host/src/components/PatternSelector.css</files>
  <action>
Create PatternSelector component for choosing winning pattern:

Props:
- currentPattern: string (current pattern type)
- onPatternChange: function to call with new pattern
- disabled: boolean (disable during loading)

Pattern options with labels:
- five_in_a_row: "5 in a Row" (row, column, or diagonal)
- four_corners: "4 Corners"
- x_pattern: "X Pattern" (both diagonals)
- full_card: "Blackout" (all 24)

Display:
- Dropdown/select with pattern options
- Show current pattern name next to dropdown
- Optional: small visual icon/preview of pattern shape

Style:
- Dark theme select matching app
- Compact for control bar placement
  </action>
  <verify>Component renders. Selecting pattern triggers onPatternChange callback.</verify>
  <done>PatternSelector.jsx and PatternSelector.css exist. Dropdown changes pattern via callback.</done>
</task>

<task type="auto">
  <name>Task 4: Update App.js with host view layout</name>
  <files>musicbingo_host/src/App.js, musicbingo_host/src/App.css, musicbingo_host/src/hooks/useGameState.js</files>
  <action>
Update App.js with new host view layout:

Layout (desktop):
- Header: Game selector + Pattern selector side by side
- Main area: Two-column grid
  - Left column (30%): CallBoard
  - Right column (70%): SongChecklist

Update useGameState hook to track playedOrder:
- playedOrder: array of song_ids in the order they were marked played
- When toggling a song to played, append to playedOrder
- When toggling to not played, remove from playedOrder
- Include playedOrder in hook return

Update SongChecklist behavior:
- Add "now playing" visual state (amber highlight, distinct from played green checkmark)
- Pass nowPlaying to SongChecklist, highlight row with pulsing/glow effect
- When clicking a song: if not played, set as now playing AND mark played

Wire up PatternSelector:
- Use setPattern action from hook
- Show loading state while pattern updates

App.css updates:
- CSS Grid for two-column layout
- Responsive: stack vertically on mobile (< 768px)
  </action>
  <verify>npm start shows new layout. Game loads with pattern selector. Clicking song sets now playing and marks played. CallBoard shows play history.</verify>
  <done>Host app has two-column layout with CallBoard, SongChecklist, PatternSelector. Now Playing tracking works.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm start in musicbingo_host/ runs without errors
- [ ] Game loads and shows in new layout
- [ ] Pattern selector shows current pattern, changes via dropdown
- [ ] Clicking song sets it as "now playing" with visual highlight
- [ ] CallBoard shows played songs in order with current song highlighted
- [ ] Layout responsive (stacks on mobile)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Host app transformed from simple checklist to full host view
- Now Playing, Call Board, and Pattern Selection all functional
</success_criteria>

<output>
After completion, create `.planning/phases/04-host-view/04-01-SUMMARY.md`
</output>
